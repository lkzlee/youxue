<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>个人中心-设置邮箱_Camplink</title>
    <script src="js/isLogin.js"></script>
    <!--[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <![endif]-->
    <script src="js/prefixfree.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/trip-calendar.css">
    <link rel="stylesheet" href="css/user.css">
</head>
<body>
<section class="header">
    <section class="head1 clear">
        <div class="left">
            <a href="#"> </a>
        </div>
        <div class="right">
            <div class="search">
                <input type="text"><div class="inco"><a href="search.html"></a></div>
            </div>
            <div class="car_inco"><a href="user_shoppingCar.html"></a></div>
            <div class="tel">
                <div class="inco"><a></a></div>
                <span>400-126-456</span>
            </div>
        </div>
    </section>
    <section class="head_nav">
        <div class="width_content">
            <nav>
                <div class="index_icon">
                    <a href="index.html"><i></i>首页</a>
                </div>
                <div class="about_icon ">
                    <a href="about.html"><i></i>关于我们</a>
                </div>
                <div class="news_icon ">
                    <a href="news.html"><i></i><span>Camplink</span>资讯</a>
                </div>
                <div class="private_icon ">
                    <a href="customized.html"><i></i>私人定制</a>
                </div>
                <div class="personal_icon" id="user_active">
                    <a href="login.html"><i></i>个人中心</a>
                </div>
            </nav>
        </div>
    </section>
</section>
<section class="user_default width_content clear">
    <ul class="left" id="userList">
        <li class="liActive"><a href="javascript:void(0)" class="a_userList">个人资料<span></span><i></i></a><!--∨∧-->
            <ul class="bounceInDown animated">
                <li><a href="user.html">基础信息</a></li>
                <li><a href="user_email_set.html" class="li_a_liActive">邮箱验证</a></li>
                <li><a href="user_message.html">我的消息</a></li>
            </ul>
        </li>
        <li><a href="javascript:void(0)" class="a_userList">我的订单<span></span><i></i></a>
            <ul>
                <li><a href="user_payment.html">待付款</a></li>
                <li><a href="user_audit.html">待审核</a></li>
                <li><a href="user_travel.html">待出行</a></li>
                <li><a href="user_finish.html">已完成</a></li>
                <li><a href="user_cancel.html">已取消</a></li>
            </ul>
        </li>
        <li><a href="javascript:void(0)" class="a_userList">我的购物车<span></span><i></i></a>
            <ul>
                <li><a href="user_shoppingCar.html">购物车</a></li><li><a href="user_product.html">周边产品</a></li>
            </ul>
        </li>
    </ul>
    <div class="setEmail_right">
        <div class="email_div1">
            <hr/>
            <div class="set_email">
                <i><b></b></i>
                <span>设置邮箱</span>
            </div>
            <div class="">
                <i><b></b></i>
                <span>激活邮箱</span>
            </div>
            <div class="">
                <i><b></b></i>
                <span>验证成果</span>
            </div>
        </div>
        <div class="email_div2 email_content" style="display:none">
            <form action="user_email_activation.html" method="post">
                <div>
                    <span>邮箱：</span>
                    <input type="text" placeholder="请输入您的邮箱账号" class="email_input">
                    <b class="email_message">
                    </b>
                </div>
                <div class="next_div">
                    <input type="button" value="下一步" id="submit_email">
                </div>
            </form>
        </div>
        <div class="activation_div2 email_content" style="display:none">
            <p>Hi,激活邮件已经发送至您的邮箱：<label id="email_label">Cindy@gmai.com</label>请前往邮箱进行激活！</p>
            <a id="email_url" href="javascript:void(0)" target="_blank">前往邮箱进行激活</a>
            <p><a class="update_email" href="javascript:void(0)">点此可更换邮箱<i>></i></a></p>
        </div>
        <div class="success_div2 email_content" style="display:none">
            <p>恭喜您，验证成功！</p>
            <a class="update_email" href="javascript:void(0)">点此可更换邮箱<i>></i></a>
        </div>
    </div>
</section>
<section class="footer">
    <div class="div1_foot">
        <span class="span1">公司地址：北京市西城区裕民路18号北环中心801</span>
        <span class="span2">加入我们：hr@123123123.com</span>
        <span class="span1">客服电话：400-755-2255</span>
        <span class="span2">公司邮箱：gongsi@123123123.com</span>
    </div>
    <div class="div2_foot">
        <p class="p1_foot">青古留学 版权所有</p>
        <p class="p2_foot">copyright 2015-2016,Complink.com.ALL Rights Reserved.</p>
    </div>
</section>
<script src="js/jquery-3.1.0.min.js"></script>
<script src="js/jquery.easing.min.js"></script>
<script src="js/public.js"></script>
<script src="js/user.js"></script>
<script>
    $(function(){
        var email_content=$('.email_content');
        var div_head=$('.email_div1').children('div');
        login_post('/uc/emailInfo.do','','',function(data){
            var data=JSON.parse(data);
            user_success(data,function(){
//                data.activeStatus=0;
                load(data);
                $('.update_email').click(function(){
                    data.activeStatus=0;
                    load(data);
                })
            })
        })
        function load(data){
            if(data.activeStatus==0){
                div_head.eq(0).addClass('email_active').siblings('.email_active').removeClass('email_active');
                email_content.eq(0).show().siblings('.email_content').hide();
                var email_input=$('.email_input');
                email_input.val(data.activeEmail);
                email_input.blur(function(){
                    var value=email_input.val();
                    check_email(value);
                })
                $('#submit_email').click(function(){
                    $(this).attr('disabled','disabled').addClass('disabled');
                    var value=email_input.val();
                    check_email(value,function(){
                        update_email(value);
                    });
                })
                function check_email(value,callback){
                    var email=$('#submit_email');
                    var message=$('.email_message');
                    if(value!="" && emailReg.test(value)){
                        //这里检测邮箱是否占用,占用的话,return false，不要在执行了
                        login_post('/uc/isUsable.do','email='+value,'',function(data){
                            data=JSON.parse(data);
                            user_success(data,function(){
                                if(data.isUsed){//true为已使用
                                    email.removeAttr('disabled').removeClass('disabled');
                                    message.html('<i class="error">×</i>&nbsp;<span>邮箱地址被占用</span>');
                                    return false;
                                }else{
                                    message.html('<i>√</i>&nbsp;<span>邮箱地址未使用</span>');
                                    callback && callback();
                                    return true;
                                }
                            })
                        });
                    }else{
                        email.removeAttr('disabled').removeClass('disabled');
                        message.html('<i class="error">×</i>&nbsp;<span>邮箱地址不正确</span>');
                        return false;
                    }
                }
                function update_email(value){
                    login_post('/uc/activeEmail.do','email='+value,'',function(data){
                        data=JSON.parse(data);
                        console.log(data);
                        user_success(data,function(){
                            load(data);
                        })
                    })
                }
            }else if(data.activeStatus==1){
                div_head.eq(1).addClass('email_active').siblings('.email_active').removeClass('email_active');
                email_content.eq(1).show().siblings('.email_content').hide();
                $('#email_label').text(data.activeEmail);
                if(data.activeEmailUrl){
                    $('#email_url').attr('href',data.activeEmailUrl);
                }else{
                    $('#email_url').click(function(){
                        alert('请前往邮箱进行验证');
                    })
                }
            }else{
                div_head.eq(2).addClass('email_active').siblings('.email_active').removeClass('email_active');
                email_content.eq(2).show().siblings('.email_content').hide();
            }
        }
    })
</script>
</body>
</html>