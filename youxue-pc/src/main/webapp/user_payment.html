<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>个人中心-待付款_Camplink</title>
    <!--[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <![endif]-->
    <script src="js/prefixfree.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/trip-calendar.css">
    <link rel="stylesheet" href="css/user.css">
</head>
<body>
<section class="header">
    <section class="head1 clear">
        <div class="left">
            <a href="#"> </a>
        </div>
        <div class="right">
            <div class="search">
                <input type="text"><div class="inco"><a href="search.html"></a></div>
            </div>
            <div class="car_inco"><a href="user_shoppingCar.html"></a></div>
            <div class="tel">
                <div class="inco"><a></a></div>
                <span>400-126-456</span>
            </div>
        </div>
    </section>
    <section class="head_nav">
        <div class="width_content">
            <nav>
                <div class="index_icon">
                    <a href="index.html"><i></i>首页</a>
                </div>
                <div class="about_icon ">
                    <a href="about.html"><i></i>关于我们</a>
                </div>
                <div class="news_icon ">
                    <a href="news.html"><i></i><span>Camplink</span>资讯</a>
                </div>
                <div class="private_icon ">
                    <a href="customized.html"><i></i>私人定制</a>
                </div>
                <div class="personal_icon" id="user_active">
                    <a href="login.html"><i></i>个人中心</a>
                </div>
            </nav>
        </div>
    </section>
</section>
<section class="user_default width_content clear">
    <ul class="left" id="userList">
        <li><a href="javascript:void(0)" class="a_userList">个人资料<span></span><i></i></a><!--∨∧-->
            <ul class="bounceInDown animated">
                <li><a href="user.html">基础信息</a></li>
                <li><a href="user_email_set.html">邮箱验证</a></li>
                <li><a href="user_message.html">我的消息</a></li>
            </ul>
        </li>
        <li class="liActive"><a href="javascript:void(0)" class="a_userList">我的订单<span></span><i></i></a>
            <ul>
                <li><a href="user_payment.html" class="li_a_liActive">待付款</a></li>
                <li><a href="user_audit.html">待审核</a></li>
                <li><a href="user_travel.html">待出行</a></li>
                <li><a href="user_finish.html">已完成</a></li>
                <li><a href="user_cancel.html">已取消</a></li>
            </ul>
        </li>
        <li><a href="javascript:void(0)" class="a_userList">我的购物车<span></span><i></i></a>
            <ul>
                <li><a href="user_shoppingCar.html">购物车</a></li><li><a href="user_product.html">周边产品</a></li>
            </ul>
        </li>
    </ul>
    <div class="right_default right_payment">
        <div class="right1">
            <div class="bghui"></div>
            <div class="imgMessage">
                <div class="img">
                    <img src="" alt="" id="photo_img" style="display:none;">
                </div>
                <a class="message" href="/user_message.html">
                    <i></i>
                    <span>6</span>
                </a>
            </div>
            <div class="hiDiv">
                <h2>Hi,<label class="nicknNme_lbl"></label>!</h2>
                <span>你的积分，<label class="integral_lbl">0</label></span>
            </div>
        </div>
        <div class="div_rigPay">
            <div class="bghui">
                <span>待付款</span>
                <!--<a href="#">收起<img src="img/payment1.jpg"/></a>-->
            </div>
            <ul class="ul_payment clear">
            </ul>
            <div class="page">
            </div>
        </div>
    </div>
</section>
<section class="footer">
    <div class="div1_foot">
        <span class="span1">公司地址：北京市西城区裕民路18号北环中心801</span>
        <span class="span2">加入我们：hr@123123123.com</span>
        <span class="span1">客服电话：400-755-2255</span>
        <span class="span2">公司邮箱：gongsi@123123123.com</span>
    </div>
    <div class="div2_foot">
        <p class="p1_foot">青古留学 版权所有</p>
        <p class="p2_foot">copyright 2015-2016,Complink.com.ALL Rights Reserved.</p>
    </div>
</section>
<script src="js/jquery-3.1.0.min.js"></script>
<script src="js/jquery.easing.min.js"></script>
<script src="js/public.js"></script>
<script src="js/user.js"></script>
<script>
    var public_obj={ 'orderType':0};
    $(function(){
        change_page('.page',public_obj,function(data){
            public_obj['pageNo']=data.pageNo;
            public_obj['totalPage']=data.totalPage;
            public_obj['totalCount']=data.totalCount;
            load();
        });
        login_post('/uc/userinfo.do','','',function(data){
            data=JSON.parse(data);
            user_success(data,function(){
                $('.nicknNme_lbl').text(data.nickName);
                $('.integral_lbl').text(data.credit);
                if(Number(data.unReads)>0){
                    $('.message').show().children('span').text(data.unReads);
                }
                if(data.photoUrl){
                    $('#photo_img').attr('src',data.photoUrl).show();
                }
            });
        });
        $('.ul_payment').on('click','.del_order',function(){
            btn_disable($(this),true)
            login_post('/uc/deleteorder.do','orderId='+$(this).attr('data-id')+'','',function(data){
                data=JSON.parse(data);
                user_success(data,function(){
                    load();
                })
            });
        })
        $('.ul_payment').on('click','.pay_order',function(){
            btn_disable($(this),true)
            login_post('/pay/addTradeOrderById.do','logicOrderId='+$(this).attr('data-id')+'','',function(data){
                data=JSON.parse(data);
                user_success(data,function(){
                    if(data.payUrl){
                        window.location.href=data.payUrl
                    }
                })
            });
        })
        load();
    })
    function load(){
        login_post('/uc/userorder.do',public_obj,'',function(data){
            data=JSON.parse(data);
            console.log(data);
            user_success(data,function(){
                render_list(data);
            })
        });
    }
    //渲染消息列表
    function render_list(data){
//        data.pageNo=5;
//        data.totalPage=10;
//        data.totalCount=100;
        public_obj['pageNo']=data.pageNo;
        public_obj['totalPage']=data.totalPage;
        public_obj['totalCount']=data.totalCount;
        var arr=[];
        var result=data['resultList'];
        var len=result.length;
        if(len<=0){
            arr.push('<li class="noMessage_border">您目前没有任何消息</li>');
        }else{
            for(var i=0;i<len;i++){
                arr.push('<li>');
                var orderList=result[i]['orderList'];
                for(var j=0,jLen=orderList.length;j<jLen;j++){
                    arr.push('<div class="list_li"><a href="/info.jsp?campusId='+orderList[j]['campsId']+'"><img src="'+handle_pic(orderList[j]['campsImages'])[0]+'"></a>');
                    arr.push('<dl><dt><a href="/info.jsp?campusId='+orderList[j]['campsId']+'">'+orderList[j]['campsTitle']+'</a></dt>');
                    arr.push('<dd><a href="/user_paymentInfo.jsp?campusId='+orderList[j]['campsId']+'">订单号：'+orderList[j]['orderId']+'</a></dd>');
                    arr.push('<dd><a href="/user_paymentInfo.jsp?campusId='+orderList[j]['campsId']+'">出发日期：'+orderList[j]['departureDate']+'</a></dd>');
                    arr.push('<dd><a href="/user_paymentInfo.jsp?campusId='+orderList[j]['campsId']+'">预定日期：'+orderList[j]['startDate']+'</a></dd></dl>');
                    arr.push('<div><span>费用：<b>¥'+orderList[j]['totalPrice']+'</b></span><input type="button" class="del_order" data-id="'+orderList[j]['orderId']+'" value="删除记录"/>');
                    arr.push('<input type="button" class="a2_payment pay_order" data-id="'+orderList[j]['logicOrderId']+'" value="立即购买"/></div></div>')
                }
                arr.push('</li>');
            }
        }
        $('.ul_payment').html(arr.join(''));
        $('.page').html(pageSet(public_obj).join(''));
    }
    function btn_disable(That,isDisabled){
        if(isDisabled){
            That.attr('disabled','disabled').addClass('disabled');
        }else{
            That.removeAttr('disabled').removeClass('disabled');
        }
    }
</script>
</body>
</html>